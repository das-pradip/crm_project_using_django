{% extends "webapp/base.html" %}
{% load static %}

{% block content %}

<style>
    body {
        background: linear-gradient(135deg, #e3f2fd, #f8f9fa);
        min-height: 100vh;
    }

    .profile-wrapper {
        min-height: calc(100vh - 120px);
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .profile-card {
        max-width: 420px;
        width: 100%;
        border-radius: 15px;
        background: #ffffff;
    }

    .profile-img {
        width: 120px;
        height: 120px;
        object-fit: cover;
        border: 4px solid #0d6efd;
        
    }

    .toggle-password {
     position: absolute;
     right: 12px;
     top: 38px;
     cursor: pointer;
     user-select: none;
     font-size: 16px;
    }
</style>

<div class="profile-wrapper">
    <div class="card profile-card shadow-lg p-4 text-center">

        <h4 class="mb-3 fw-bold">My Profile</h4>

        <img
            src="{% if request.user.profile.profile_image %}
                    {{ request.user.profile.profile_image.url }}
                 {% else %}
                    /media/profiles/default.png
                 {% endif %}"
            class="rounded-circle profile-img mb-3 d-block mx-auto"
            alt="Profile Image"
        >

        <p class="mb-1"><strong>Username:</strong> {{ request.user.username }}</p>
        <p class="mb-3">
            <strong>Role:</strong>
            <span class="badge bg-primary">{{ request.user.profile.role|title }}</span>
        </p>

        <form method="POST" enctype="multipart/form-data">
            {% csrf_token %}
            <input type="file" name="profile_image" class="form-control mb-3">
            <button class="btn btn-primary w-100">
                Update Photo
            </button>
        </form>

       <a href="{% url 'dashboard' %}" class="btn btn-secondary w-100 mt-2">
            ‚¨Ö Return to Dashboard
       </a>


       <div class="card p-4 shadow-sm mt-4">

  <h5 class="text-center mb-3">Security</h5>

  <!-- Toggle Button -->
  <button class="btn btn-outline-warning w-100 mb-3"
          type="button"
          onclick="togglePasswordForm()">
    üîí Change / Forgot Password
  </button>

  <!-- Password Form (Hidden by default) -->
  <div id="passwordForm" style="display: none;">

    {% if password_form.errors %}
      <div class="alert alert-danger">
        {{ password_form.errors }}
      </div>
    {% endif %}

    <form method="POST">
      {% csrf_token %}

      <div class="mb-3 position-relative">
        <label class="form-label">Old Password</label>

       <input type="password"
         name="old_password"
         class="form-control password-field"
         required>

       <span class="toggle-password" onclick="togglePassword(this)">
           üëÅÔ∏è
       </span>
       </div>

      <div class="mb-3 position-relative">
        <label class="form-label">New Password</label>

        <input type="password"
         name="new_password1"
         class="form-control password-field"
         required>

        <span class="toggle-password" onclick="togglePassword(this)">
            üëÅÔ∏è
        </span>
       </div>


        <div class="mb-3 position-relative">
         <label class="form-label">Confirm New Password</label>

           <input type="password"
            name="new_password2"
            class="form-control password-field" required>

           <span class="toggle-password" onclick="togglePassword(this)">
             üëÅÔ∏è
            </span>
        </div>


        <button class="btn btn-warning w-100">
            Update Password
        </button>

    </form>
  </div>
</div>

</div>
</div>

<script src="{% static 'js/forgot-password.js' %}"></script>

{% endblock %}
